<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 222.2 47.4% 11.2%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --radius: 0.5rem;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            flex: 1;
        }

        header {
            border-bottom: 1px solid hsl(var(--border));
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: hsl(var(--muted-foreground));
            font-size: 0.875rem;
        }

        .card {
            background-color: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }

        .card-header {
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .card-description {
            color: hsl(var(--muted-foreground));
            font-size: 0.875rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: hsl(var(--foreground));
        }

        input[type="text"],
        input[type="url"] {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid hsl(var(--input));
            border-radius: calc(var(--radius) - 2px);
            font-size: 0.875rem;
            transition: all 0.2s;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }

        input[type="text"]:focus,
        input[type="url"]:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 3px hsl(var(--ring) / 0.1);
        }

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: calc(var(--radius) - 2px);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            padding: 0.5rem 1rem;
            gap: 0.5rem;
        }

        .button-primary {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .button-primary:hover {
            background-color: hsl(var(--primary) / 0.9);
        }

        .button-secondary {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }

        .button-secondary:hover {
            background-color: hsl(var(--secondary) / 0.8);
        }

        .button-destructive {
            background-color: hsl(var(--destructive));
            color: hsl(var(--destructive-foreground));
        }

        .button-destructive:hover {
            background-color: hsl(var(--destructive) / 0.9);
        }

        .button-ghost {
            background-color: transparent;
            color: hsl(var(--foreground));
        }

        .button-ghost:hover {
            background-color: hsl(var(--accent));
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .alert {
            padding: 1rem;
            border-radius: calc(var(--radius) - 2px);
            margin-bottom: 1rem;
            font-size: 0.875rem;
            border: 1px solid;
        }

        .alert-success {
            background-color: hsl(142.1 76.2% 96%);
            color: hsl(142.1 76.2% 36.3%);
            border-color: hsl(142.1 76.2% 86.3%);
        }

        .alert-error {
            background-color: hsl(0 84.2% 96%);
            color: hsl(0 84.2% 40.2%);
            border-color: hsl(0 84.2% 86.2%);
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .result-box {
            background-color: hsl(var(--muted));
            border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius) - 2px);
            padding: 1rem;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .result-url {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            color: hsl(var(--primary));
            word-break: break-all;
            flex: 1;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table thead {
            border-bottom: 1px solid hsl(var(--border));
        }

        .table th {
            text-align: left;
            padding: 0.75rem;
            font-weight: 600;
            font-size: 0.875rem;
            color: hsl(var(--muted-foreground));
        }

        .table td {
            padding: 0.75rem;
            border-bottom: 1px solid hsl(var(--border));
            font-size: 0.875rem;
        }

        .table tbody tr:hover {
            background-color: hsl(var(--muted) / 0.5);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: 9999px;
            padding: 0.125rem 0.625rem;
            font-size: 0.75rem;
            font-weight: 600;
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }

        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid hsl(var(--primary-foreground));
            border-radius: 50%;
            border-top-color: transparent;
            animation: spinner 0.6s linear infinite;
        }

        @keyframes spinner {
            to {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: hsl(var(--muted-foreground));
        }

        .empty-state svg {
            width: 3rem;
            height: 3rem;
            margin: 0 auto 1rem;
            opacity: 0.5;
        }

        .code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: hsl(var(--muted));
            padding: 0.125rem 0.375rem;
            border-radius: calc(var(--radius) - 4px);
            font-size: 0.875em;
        }

        .grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .stat-card {
            background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--primary) / 0.8) 100%);
            color: hsl(var(--primary-foreground));
            padding: 1.5rem;
            border-radius: var(--radius);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        footer {
            border-top: 1px solid hsl(var(--border));
            padding: 1.5rem 0;
            margin-top: 3rem;
            text-align: center;
            color: hsl(var(--muted-foreground));
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            .container {
                padding: 1rem;
            }

            .card {
                padding: 1rem;
            }

            .result-box {
                flex-direction: column;
                align-items: stretch;
            }

            .table {
                font-size: 0.75rem;
            }

            .table th,
            .table td {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîó URL Shortener</h1>
            <p class="subtitle">Create short, memorable links in seconds</p>
        </header>

        <!-- Stats Section -->
        <div class="grid" style="margin-bottom: 2rem;">
            <div class="stat-card">
                <div class="stat-value" id="totalUrls">0</div>
                <div class="stat-label">Total URLs</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">
                <div class="stat-value" id="totalClicks">0</div>
                <div class="stat-label">Total Clicks</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                <div class="stat-value" id="avgClicks">0</div>
                <div class="stat-label">Avg Clicks/URL</div>
            </div>
        </div>

        <!-- Create URL Section -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Create Short URL</h2>
                <p class="card-description">Enter a long URL to get a shortened version</p>
            </div>

            <div id="alertContainer"></div>

            <form id="shortenForm">
                <div class="form-group">
                    <label for="urlInput">Long URL</label>
                    <input 
                        type="url" 
                        id="urlInput" 
                        placeholder="https://example.com/very/long/url/path" 
                        required
                    >
                </div>

                <button type="submit" class="button button-primary" id="submitBtn">
                    <span id="submitText">Shorten URL</span>
                    <span id="submitLoader" class="loading" style="display: none;"></span>
                </button>
            </form>

            <div id="resultContainer" style="display: none;">
                <div class="result-box">
                    <div class="result-url" id="shortUrl"></div>
                    <button class="button button-secondary" onclick="copyToClipboard()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy
                    </button>
                </div>
            </div>
        </div>

        <!-- URLs List Section -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Your URLs</h2>
                <p class="card-description">View and manage all shortened URLs</p>
            </div>

            <div id="urlsTableContainer">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                    <p>No URLs yet. Create your first short URL!</p>
                </div>
            </div>
        </div>

        <footer>
            <p>Built with ‚ù§Ô∏è using Go and shadcn-inspired design</p>
        </footer>
    </div>

    <script>
        const API_BASE = '/api';
        let currentShortUrl = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadUrls();
            setupForm();
        });

        // Setup form submission
        function setupForm() {
            document.getElementById('shortenForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const urlInput = document.getElementById('urlInput');
                const url = urlInput.value.trim();

                if (!url) return;

                setLoading(true);
                hideAlert();

                try {
                    const response = await fetch(`${API_BASE}/shorten`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        currentShortUrl = data.short_url;
                        showResult(data.short_url);
                        showAlert('Success! Your short URL is ready.', 'success');
                        urlInput.value = '';
                        loadUrls(); // Refresh the list
                    } else {
                        showAlert(data.error || 'Failed to create short URL', 'error');
                    }
                } catch (error) {
                    showAlert('Network error. Please try again.', 'error');
                } finally {
                    setLoading(false);
                }
            });
        }

        // Load URLs list
        async function loadUrls() {
            try {
                const response = await fetch(`${API_BASE}/urls`);
                const urls = await response.json();

                if (urls && urls.length > 0) {
                    updateStats(urls);
                    renderUrlsTable(urls);
                } else {
                    document.getElementById('urlsTableContainer').innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                            </svg>
                            <p>No URLs yet. Create your first short URL!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load URLs:', error);
            }
        }

        // Update statistics
        function updateStats(urls) {
            const totalUrls = urls.length;
            const totalClicks = urls.reduce((sum, url) => sum + url.clicks, 0);
            const avgClicks = totalUrls > 0 ? Math.round(totalClicks / totalUrls) : 0;

            document.getElementById('totalUrls').textContent = totalUrls;
            document.getElementById('totalClicks').textContent = totalClicks;
            document.getElementById('avgClicks').textContent = avgClicks;
        }

        // Render URLs table
        function renderUrlsTable(urls) {
            const container = document.getElementById('urlsTableContainer');
            container.innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Short Code</th>
                            <th>Original URL</th>
                            <th>Clicks</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${urls.map(url => `
                            <tr>
                                <td>
                                    <span class="code">${url.short_code}</span>
                                </td>
                                <td>
                                    <a href="${url.original_url}" target="_blank" style="color: hsl(var(--primary)); text-decoration: none;">
                                        ${truncateUrl(url.original_url)}
                                    </a>
                                </td>
                                <td>
                                    <span class="badge">${url.clicks}</span>
                                </td>
                                <td>${formatDate(url.created_at)}</td>
                                <td>
                                    <button class="button button-ghost" onclick="copyUrlToClipboard('${window.location.origin}/${url.short_code}')" style="padding: 0.25rem 0.5rem;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                    <button class="button button-ghost" onclick="viewStats('${url.short_code}')" style="padding: 0.25rem 0.5rem;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Helper functions
        function showResult(shortUrl) {
            document.getElementById('shortUrl').textContent = shortUrl;
            document.getElementById('resultContainer').style.display = 'block';
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            container.innerHTML = `
                <div class="alert alert-${type}">
                    <div class="alert-title">${type === 'success' ? 'Success' : 'Error'}</div>
                    <div>${message}</div>
                </div>
            `;
            setTimeout(hideAlert, 5000);
        }

        function hideAlert() {
            document.getElementById('alertContainer').innerHTML = '';
        }

        function setLoading(loading) {
            const btn = document.getElementById('submitBtn');
            const text = document.getElementById('submitText');
            const loader = document.getElementById('submitLoader');
            
            btn.disabled = loading;
            text.style.display = loading ? 'none' : 'inline';
            loader.style.display = loading ? 'inline-block' : 'none';
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(currentShortUrl).then(() => {
                showAlert('Copied to clipboard!', 'success');
            });
        }

        function copyUrlToClipboard(url) {
            navigator.clipboard.writeText(url).then(() => {
                showAlert('URL copied to clipboard!', 'success');
            });
        }

        async function viewStats(shortCode) {
            try {
                const response = await fetch(`${API_BASE}/stats/${shortCode}`);
                const data = await response.json();
                
                if (response.ok) {
                    showAlert(`
                        Short Code: ${data.short_code}<br>
                        Clicks: ${data.clicks}<br>
                        Created: ${formatDate(data.created_at)}
                    `, 'success');
                }
            } catch (error) {
                showAlert('Failed to load stats', 'error');
            }
        }

        function truncateUrl(url, maxLength = 50) {
            return url.length > maxLength ? url.substring(0, maxLength) + '...' : url;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInMs = now - date;
            const diffInMins = Math.floor(diffInMs / 60000);
            const diffInHours = Math.floor(diffInMs / 3600000);
            const diffInDays = Math.floor(diffInMs / 86400000);

            if (diffInMins < 1) return 'Just now';
            if (diffInMins < 60) return `${diffInMins}m ago`;
            if (diffInHours < 24) return `${diffInHours}h ago`;
            if (diffInDays < 7) return `${diffInDays}d ago`;
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
    </script>
</body>
</html>